# 7️⃣ Compiler le projet (Cible Sideloadly / Xcode 26.1.1)
    - name: Build
      run: |
        cd build
        # Localisation du projet principal
        PROJECT_PATH=$(find . -name "Play.xcodeproj" -not -path "*/AutoTest/*" | head -n 1)
        
        xcodebuild build \
          -project "$PROJECT_PATH" \
          -scheme Play \
          -configuration Release \
          -sdk iphoneos \
          -destination "platform=iOS" \
          IPHONEOS_DEPLOYMENT_TARGET=15.0 \
          CODE_SIGNING_ALLOWED=NO \
          CODE_SIGNING_REQUIRED=NO \
          CODE_SIGN_IDENTITY="" \
          AD_HOC_CODE_SIGNING_ALLOWED=YES \
          -skipPackagePluginValidation \
          -skipMacroValidation

        # Recherche du binaire .app
        APP_PATH=$(find $(pwd) -name "Play.app" -type d | grep "Release-iphoneos" | head -n 1)
        if [ -d "$APP_PATH" ]; then
          echo "APP_FINAL_PATH=$APP_PATH" >> $GITHUB_ENV
        else
          echo "ERREUR : Play.app introuvable"
          exit 1
        fi

    # 8️⃣ Générer l’IPA (Structure correcte pour Sideloadly)
    - name: Generate IPA
      run: |
        mkdir -p Payload
        # On copie l'application dans le dossier Payload (obligatoire pour l'IPA)
        cp -r "${{ env.APP_FINAL_PATH }}" Payload/
        # Création de l'archive IPA
        zip -r Play_Vulkan_Sideload.ipa Payload

    # 9️⃣ Exportation de l'artéfact
    - name: Upload IPA
      uses: actions/upload-artifact@v4
      with:
        name: Play_Sideload_Version
        path: Play_Vulkan_Sideload.ipa
